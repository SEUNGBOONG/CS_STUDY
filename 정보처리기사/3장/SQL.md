# SQL


- DBMS의 표준언어 
- 관계 대수를 기초로 만들어짐

1. 데이터 정의어 (DDL):
   - 데이터 조작을 위한 공간 *정의 *수정 *변경 하는 언어 데이터베이스 관리자가 사용
   - 
     CREATE TABLE STUDENT(
     NAME INT PRIMARY KEY,
     NUMBER CHAR(10) NOT NULL,
     BOOK VARCHAR(20) NOT NULL,
     FOREIGN KEY (NAME) REFERENCES NAME(NUMBER)
     )


     - NO ACTION : 무시 
     - SET DEFAULT : 관련 튜플 모두 기본 값 지정
     -  *  CASCADE : 관련된 튜플 모두 함께 처리
     -  * RESTRICT : 관련된 튜플이 없는 경우에만 처리

  - ALTER
    - ENABLE 
    - DISABLE
    - DROP : 제약조건 삭제
    
    
  - DROP:  데이터 베이스 삭제
    - 객체를 삭제한다.
    - 
  - TRUNCATE 


2. 데이터 조작어 (DML):
   - 검색 삽입 갱신 삭제 
   - INSERT
     - INSERT INTO 테이블명 VALUES 
   - UPDATE
     - UPDATE 테이블명 SET 컬렴명 값 WHERE 조건식

  - DELETE
    -  DELETE FROM 테이블명 WHERE 조건식
  
  - SELECT
  - AS 집계함수 사용 가능 
    - COUNT
    - SUM
    - MAX ..
    - STDDEV : 표준편차
    - VARIANCE :  분산 
    - SELECT 이름 AS 학생명, 점수-5 AS 성적 FROM 학생정보;
    -  조건식 : 
      -  LIKE %강 : 강으로 끝나는 문자열
      -  LIKE 이 %: 이으로 시작하는 문자열

    - 하위 질의 
      - 서브쿼리정의
  
      - SELECT * FROM 성적 WHERE 학과 = (SELECT 학과 FROM 성적 WHRER 이름= "이승엽")



3. 데이터 제어어(DCL):
   - 접근 통제와 병행 수행을 위한 제어언어
   - GRANT :권한 부여
   - REVOKE :회수 
   - COMMIT : 최종반영
   -  트랜잭션: DML이 하나 이상 모인 단위 작업
   - 분해할 수 없는 최소단위
   - ACID : 원자성, 일관성, 고립성, 지속성 
   *  원자성: 모든 연산이 수행되거나 하나도 수행되지 않아야한다.
   *  일관성: 트랜잭션 이후에도 같아야함
   *  고립성: 실행 도중 다른 트랜잭션의 영향을 받지 말아야한다.
   *  지속성 : 항상 영구 반영되어야한다.
   

  - ROLLBACK: 트랜잭션에 의한 변경사항을 이전 상황으로 복구
  - CHECKOPOINT 


- 프로시저 : 호출을 통해 실행되는 절차형 SQL 
  - DML위주로 구성되며 주기적으로 반복되는 작업에 사용
  


 - INDEX : 
   - 저장된 데이터를 빠르게 검색할 수 있도록 구성된 자료구조 및 방법
   - 컬름을 기본키로 설정하면 인덱스는 자동으로 생성된다.
   - 너무 넓은 범위 인덱스는 추가적인 저장공간 및 오버헤드를 발생시킨다.
   - 인덱스와 테이블  데이터의 저장공간은 적절히 분리한다.
     - UNIQUE : 중복값을 허용하지 않는 인덱스 생성

- VIEW :
  - 논리적인 가상 테이블
  - 시스템 카탈로그에 저장됨 
  - 뷰를 통한 또다른 뷰 가능
  - 종속된 테이블이 제거되면 함께 제거
  - 단순화 다양화 가능
  - 인덱스 사용 불가능 내용을 수정하는 것도 제약이따른다.
  - 변경하기 위해서는 삭제한뒤 생성


- 시스템 카탈로그 :
- 정의와 명세를 메타 데이터 형태로 유지관리하는 시스템 테이블 
- 데이터사전이라고도 한다.
- DBA가 사용하는 데이터 사전과 같은 의미
- 스스로 생성하고 유지하며 디렉토리에 저장된 접근 정보를 통해 접근
- JDBC MYBATIS 같은 것들 이 있다.



 # 병행 제어 로킹 
- 병행제어 : 활용도를 높이기 위해서 여러 사용자들의 데이터베이스 공동 사용을 최대화한다.
- 문제점을 개선하여 일관성을 유지
- 문제점 : 
  - 분실 갱신 : 두개의 트랜잭션이 갱신하면서 하나의 작업이 진행되지 않는 경우의 문제점
  - 모순성 : 두 개의 트랜잭션이 갱신하면서 사용자가 원하는 결과와 일치하지않음
  - 연쇄 복귀 : 갱신 전으로 복귀하는 상태가 되는 경우
  - 비완료 의존성 : 회복이 이뤄지기전에 다른 트랜잭션이 실패한 수행결과를 참조하는 경우의 문제점
  
- 로킹 : 트랜잭션  갱신 중에 다른 트랜잭션이 접근하지 못하도록 잠그는 것 
- 단위 크기에 따라 성능에 영향을 미치므로 적절한 크기를 지정한다.
- 로크 단위가 크다 () - > 5평 짜리 원룸에서 로킹단위를 몸무게로 치환했을 떄 로킹단위가 클수록 병행성,오버헤드가 감소한다 () -> 한 방공간이 좁아지므로 병행성 오버헤드가 감소한다로 이해 
- 로크 단위가 작으면  반대로 생각 
- 타임스탬프 기법 : 트랜잭션이 순서대로 처리 하도록 타임 스탬프를 부여한다.
- 다중 버전 병행제어 기법 : 타임스탬프를 비교하여 직렬 가능성이 보장되는 버전을 선택

- 회복: 특정 장애로인해 데베 문제 무결성훼손이 발생했을떄 이전의 상태로 복원하는 것
  - UNDO : 변경된 데이터를 취소하여 원래의 내용으로 복원

  - REDO : Undo로인해 회복된 내역이 기록된 로그를 바탕으로 

  - 즉시 갱신 : 트랜잭션의 결과를 그 즉시반영 Undo  커밋 할때마다 푸쉬 
  - 지연 갱신 : 갱신 결과를 로그에 기록 한번에 반영 git 으로 따지면 커밋을 전부해놓고 한번에 푸쉬



