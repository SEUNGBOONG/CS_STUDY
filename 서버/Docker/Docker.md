Docker는 애플리케이션을 격리된 환경에서 실행할 수 있는 컨테이너 기반의 가상화 기술입니다. 도커의 원리를 이해하려면 몇 가지 주요 개념을 알아야 합니다: 이미지, 컨테이너, 레지스트리, 네트워크, 볼륨. 각 구성 요소가 어떻게 동작하고 상호작용하는지 자세히 살펴보겠습니다.

1. 이미지 (Image)
   도커 이미지는 애플리케이션과 그 실행에 필요한 환경(파일 시스템, 라이브러리, 설정 파일 등)을 모두 포함하는 템플릿입니다. 이는 일종의 "스냅샷"으로, 코드, 종속성, 도구 및 애플리케이션을 실행하기 위한 모든 것을 포함합니다. 이미지의 중요한 특징은 불변성으로, 이미지를 만들고 나면 변경할 수 없습니다.

이미지의 구조는 여러 레이어로 이루어져 있으며, 각 레이어는 이전 레이어에 덧붙이는 방식으로 동작합니다. 레이어 기반 시스템 덕분에 여러 이미지가 동일한 레이어를 공유할 수 있어 저장 공간이 절약됩니다

이미지 생성 과정
Dockerfile에 정의된 명령어(FROM, RUN, COPY 등)를 기반으로 이미지를 빌드합니다.
각 명령어는 새로운 레이어를 생성하며, 이 레이어들은 캐시됩니다.
마지막으로 이미지를 저장소에 저장하거나 docker run 명령을 통해 실행할 수 있습니다.
2. 컨테이너 (Container)
   컨테이너는 이미지를 실행한 상태입니다. 이미지가 불변 템플릿이라면, 컨테이너는 그 템플릿을 기반으로 실제 실행되는 애플리케이션입니다. 도커 컨테이너는 실행 중인 애플리케이션에 필요한 모든 것(파일 시스템, 라이브러리, 네트워크 설정 등)을 포함하지만, 호스트 운영체제의 커널을 공유하여 실행됩니다.

컨테이너는 가볍고 독립적인 실행 환경을 제공하며, 각각의 컨테이너는 서로 격리되어 있습니다. 이 격리 덕분에 다른 컨테이너와 간섭 없이 특정 애플리케이션을 실행할 수 있습니다.
3. 도커의 가상화 방식
   도커는 전통적인 가상 머신과 다르게 하이퍼바이저 없이 호스트 운영체제의 커널을 공유합니다. 이는 도커가 컨테이너화(Containerization) 기술을 기반으로 하며, 다음과 같은 특징이 있습니다:

커널 공유: 컨테이너는 호스트 운영체제의 커널을 공유하여 실행되므로, 가상 머신보다 리소스 사용이 적고 성능이 뛰어납니다.
격리: 각 컨테이너는 고유의 파일 시스템, 네트워크, 프로세스 공간을 가지고 있으며, 다른 컨테이너나 호스트 시스템과 격리되어 실행됩니다.

4. 도커 네트워크 (Docker Network)
   컨테이너 간의 통신을 위해 도커는 네트워크를 제공합니다. 기본적으로 모든 컨테이너는 같은 네트워크에 속할 수 있고, 컨테이너 이름을 통해 서로 통신할 수 있습니다. 네트워크 모드는 다음과 같이 나뉩니다:

브리지(Bridge) 네트워크: 기본 네트워크로, 각 컨테이너는 가상 네트워크 인터페이스를 통해 통신합니다.
호스트(Host) 네트워크: 컨테이너가 호스트와 동일한 네트워크 환경을 공유합니다.
오버레이(Overlay) 네트워크: 클러스터에서 여러 호스트에 걸쳐 네트워크를 구성할 때 사용됩니다.
5. 볼륨 (Volume)
   도커 컨테이너는 기본적으로 독립적인 파일 시스템을 가지고 있습니다. 하지만, 컨테이너가 삭제되면 내부 데이터는 사라지므로 볼륨을 사용하여 데이터를 호스트 시스템이나 외부 스토리지에 영구적으로 저장할 수 있습니다.

익명 볼륨: 도커가 자동으로 생성하며, 컨테이너 종료 시에도 데이터를 유지할 수 있습니다.
네임드 볼륨: 사용자가 이름을 지정하고 관리하는 볼륨으로, 여러 컨테이너에서 데이터를 공유할 수 있습니다.
바인드 마운트: 호스트 시스템의 특정 디렉토리를 컨테이너에 마운트하여 데이터 공유가 가능합니다.
6. 도커 레지스트리 (Docker Registry)
   도커 이미지를 저장하고 배포할 수 있는 레지스트리가 있습니다. 대표적으로 도커 허브(Docker Hub)가 있으며, 개인적인 용도로는 프라이빗 레지스트리를 설정할 수 있습니다.

도커 허브: 가장 많이 사용되는 퍼블릭 레지스트리입니다. 이미지를 다운로드하거나 업로드할 수 있습니다.
프라이빗 레지스트리: 기업이나 개인이 사용할 수 있는 비공개 이미지 저장소입니다.
7. 도커의 실행 흐름
   이미지 빌드: Dockerfile을 작성하고, 이를 통해 이미지를 빌드합니다.
   컨테이너 실행: 빌드된 이미지를 기반으로 컨테이너를 실행합니다. 이 때, 컨테이너는 애플리케이션이 동작할 독립된 실행 환경을 갖게 됩니다.
   네트워크 설정: 컨테이너들이 서로 통신할 수 있도록 네트워크를 구성하거나, 외부 네트워크에 연결합니다.
   볼륨 설정: 데이터를 유지하거나 공유하기 위해 볼륨을 설정합니다.
   예시: 도커로 MySQL과 Spring 애플리케이션 실행하기

1.  MySQL 이미지 실행: MySQL 컨테이너를 띄워 데이터베이스를 설정합니다. 호스트와 포트를 매핑하고, 환경 변수를 사용해 사용자 및 비밀번호를 설정합니다.
- docker run -d --name mysql-db -e MYSQL_ROOT_PASSWORD=sosow0212 -e MYSQL_DATABASE=investment -p 3306:3306 mysql:8.0
2. Spring 애플리케이션 빌드: Dockerfile을 작성하여 애플리케이션을 빌드하고 이미지를 생성합니다.
- docker build -t my-spring-app .
3. 컨테이너 네트워크 설정: MySQL과 애플리케이션 컨테이너 간의 통신을 위해 같은 네트워크에 포함시킵니다.
 - docker network create app-network
   docker network connect app-network mysql-db
   docker network connect app-network my-spring-app

4. Spring 애플리케이션 실행: MySQL 컨테이너와 같은 네트워크에서 실행되도록 설정하고 애플리케이션을 띄웁니다.
 - docker run -d --name spring-app --network app-network -p 8080:8080 my-spring-app

