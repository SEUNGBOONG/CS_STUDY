
# Domain Driven Design 

- 개발자 입장에서 보면 온라인 서점은 구현해야할 소프트웨어의 대상이다. 
- 책을 판매하는데 필요한 상품 조회 구매 결제 배소우적등의 기능을 제공해야한다.
- 한 도메인은 다시 하위 도메인으로 나눌수 있다.


전문가와 개발자 간 지식공유: 
온라인 홍보 정산 배송등 각영역에는 전문가가 있다. 이들 전문가는 해당 도메인에 대한 지식과 경험을 바탕으로 본인들이 원하는 기능 개발을 요구한다.
예를 들어 회계 담당자는 엑셀로 맞추던 정산금액 게산을 자동화해주는 기능을 요구할 수 있다. 
이런 요구사항을 분석하고 설계하여 코드를 작성하며 테스트하고 배포한다. 
이 과정에서 요구사항은 첫단추이다 .

그래서 코딩에 앞서 요구사항을 올바르게 이해하는 것이 중요하다. 
요구사항을 제대로 이해하지 않으면 쓸모없거나 유용함이 떨어진다.

개발자와 전문가가 직접 대화하는 것이 제일 좋다.

Garbage in GarBage out 찾아보기 

도메인 모델에는 다양한 정의가 존재한다. 
기본적으로 도메인 모델은 특정 도메인을 개념적으로 표현한 것이다. 
도메인 모델을 사용하면 여러 관계자들이 동일한 모습으로 이해하고 도메인 지식을 공유하는데 도움이 된다.

모델을 표현할 때 클래스 다이어그램이나 상태 다이어그램과 같은 UML 표기법만 사용해야 하는 것은 아니다. 
관계가 중요한 도메인이라면 그래프를 이용해서 도메인을 모델링할 수 있다.

인프라스트럭처: Infrastructure : 데이터베이스 메시징 시스템과 같은 외부시스템과의 연동을 처리한다.

도메인 모델 : 도메인 자체를 표현하는 개념적인 모델을 의미하지만, 도메인 계층을 구현할 때 사용하는 객체 모델을 언글할 때에도 도메인 모델이란 용어를 사용한다.

도출한 모델은 크게 엔티티와 밸류로 구분할 수 있다. 
이것을 제대로 구분해야 도메인을 올바르게 설계하고 구현할 수 있기 때문이다. 

엔티티: 가장 큰 특징은 식별자를 가진다는 것이다. 
객체마다 고유해서 각엔티티는 서로 다른 식별자를 갖는다. 
고유하기 때문에 두엔티티 객체의 식별자가 같으면 두엔티티는 같다고 판단할 수 있다.

흔히 식별자는 
특정 규칙에 따라 생성
UUID
값을 직접입력
일련번호 사용 등으로 생성한ㄴ다.

자바는 import.java.util.UUID 클래스를 사용할수 있다.


밸류 타입은 개념적으로 완전한 하나를 표현할 때사용한다. : VO 필드는 여러개가능 


도메인 모델에는 set메서드 넣지않기 
겟셋 메서드를 습관적으로 추가할때가 있다. 
## 무조건 추가하는 것은 좋지 않은 버릇이다. 특히 셋메서드는 도메인의 핵심개념이나 의도를 코드에서 사라지게한다.

private 일때 외부에서 데이터를 변경할 목적으로 set메서드를 사용할 수 없다.
불변 밸류타입을 사용하면 자연스럽게 밸류타입에는 셋메서드를 구현하지않는다.

DTO :Data Transfer Object 의 약자로 프레젠테이션 계층과 도메인 계층이 데이터를 서로 주고받을 때 사용하는 일종의 구조체이다. 



표현 영역은  웹브라우저가 HTTP요청 파라미터로 전송한 데이터를 응용 서비스가 요구하는 형식 객체타입을 ㅗ변환해서 잔달하고 응용 서비스가 리턴한 결과를 JSOn형식으로 변호나해서 HTTP응답으로 웹브라우저에 전송한다.
응용 서비스는 로직을 직접 수행한다기보단 도메인 모델에 로직 수행을 위임한다. 

인프라스트럭처 영역은 구현기술에 대한 것을 다룬다 이영역은 RDBMS 연동을 처리하고 메시징 큐에 메시지를 전송하거나 수신하는 기능을 구현하고 몽고디비 레디스와 의 데이터연동을 처리한다.
SMTP를 이용해 메일 발송 기능을 구현하거나 HTTP 클라이언트를 이용해서 REST API를 호출하는 것도 처리한다. 
논리적인 개념을 표혆사기보다는 실제 구현을 다룬다. 


인프라스트럭처에 의존하면 테스트 어려움과 기능 확장의 어려움이라는 두 가지 문제가 발생한다. 
이것을 DIP로 해결한다. 
저수준 모듈이 고수준 모듈에 의존하도록 바꾼다. 고수준 모듈을 구현하려면 저수준 모듈을 사용해야 하는데, 반대로 저수준 모듈이 고수준 모듈에 의존하도록하려면 어떻게해야할까 
비밀은 추상화한 인터페이스에 있다.

고수준 모듈이 저수준 모듈을 사용하려면 고수준 모듈이 저수준 모듈에 의존해야하는데 반대로 저수준이 모듈이 고수준 모듈에 의존한다고 해서 이를 DIP  의존역전원칙이라고 부른다.

DIP를 적용하면 앞의 다른 영역이 인프라스트럭처 영역에 의존할 때 발생헀던 두 가지 문제인 구현 교체가 어렵다는 것과 테스트가 어려운 문제를 해소할 수 있다.

애그리거터는 군집에 속한 객체를 관리하는 루트 엔티티를 갖는다. 
내부구현을 숨겨서 애그리거트 단위로 구현을 캡슐화 할 수 있도록 돕는다.

복잡한 도메인을 이해하고 관리하기 쉬운 단위로 만들려면 상위 수준에서 모델을 조망할 수 있ㄷ는 방법이 필요하다. 그 방법이 바로 애그리거트 
관련된 객체를 하나의 군으로 묶어준다.
모두 일관된 상태를 유지하려면 애그리거트 전체를 관리할 주체가 필요한데 이책임을 지는 것이 바로 애그리거트의 루트 엔티티이다.

트랜잭션의 범위는 작을수록 좋다. 한 트랜잭션이 한개 테이블을 수정하는 것과 세개의 테이블을 수정하는 것을 비교하면 성능에서 차이가 발생한다.
한트랜잭션에서는 한개의 애그리거트 만 수정해야하낟.
애그리거트는 개념적으로 하나이므로 리포지터리는 애그리거트 전체를 저장소에 영속화 해야한다.

리포지터리가 완전한 에그리거트를 제공하지 않으면 필드나 값이 올바르지않아 애그리거트의 기능을 실행하는 도중에 널포인트 익셉션 과 같은 문제가밠애한다.



