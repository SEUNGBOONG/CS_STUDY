# 낙관적 락 비관적 락

---

- 동시에 여러 사용자가 같은 데이터를 수정하려고 할 때, 데이터 정합성을 유지하는 방법 중 하나 Locking 기법 !

---
#낙관적 락
---

1. 낙관적 락 개념 🚀
    - 데이터 충돌이 드물 것이라는 가정하에 적용하는 방식
    - 별도의 잠금을 걸지 않고, 데이터를 조회할 때 Version 값을 함께 저장
    - 데이터 수정 시, 기존 버전과 DB의 버전을 비교하여 충돌이 있으면 예외를 발생시키게 한다.
    - 충돌이 발생하면 사용자가 재시도하거나 클라이언트에게 알림을 보낼 수 있음

2. 언제 사용하지? 🚀
    - 경합이 적은 환경 -> 수정 충돌 가능성이 낮을 때
    - Read가 많고, Write는 적은 경우 사용한다.
    - 비관적 락처럼 트랜잭션을 오래 유지할 필요가 없을 때
    - 사용자가 재시도하는 로직이 허용될 수 있을 때 사용

    - ex) 좋아요 기능 증가 감소..
        - 게시물에 좋아요를 여러 명이서 누르지만, 동시에 같은 데이터를 수정할 가능성이 높지 않다.
        - 좋아요 수 업데이트 시 충돌이 발생하면 다시 시도하세요라고 안내를 해줌. -> Exception 처리

    - ex) 쇼핑몰에서 재고 업데이트
        - 같은 상품이 동시에 주문될 가능성은 있지만, 대량의 트랜잭션이 한 번에 발생하지 않는다? -> 낙관적 락 사용을 고려해볼 필요가 있다
        - Version 충돌 시 "다시 시도" 메세지를 띄우고 재시도

----

# 비관적 락

1. 비관적 락 개념 🚀
    - 데이터를 수정할 가능성이 높음. 그러므로 수정하는 동안 트랜잭션이 접근하지 못하도록 잠금처리
    - 데이터 수정이 완료될 때까지 다른 트랜잭션이 해당 데이터에 접근 불가
    - 충돌이 미리 방지되는 장점이 있음 -> 트랜잭션이 접근 불가하니까 -> 대기 시간이 길어지고 성능이 저하될 수 있음

2. 언제 사용하지? 🚀
    - 경합이 많은 환경 -> 데이터 충돌 가능성이 높음 즉 사용자가 동시에 사용할 가능성이 높다.
    - Read 보다 Write 가 많은 경우
    - 무결성이 중요하고, 충돌이 절대 발생하면 안된다.
    - 낙관적 락을 사용하면 충돌이 너무 자주 발생하여 재시도 비용이 커지는 경우-> 고려해볼 가치가 있음

    - ex) 은행 계좌 출금/이체
        - 같은 계좌에서 동시에 출금 요청이 발생 충돌이 나면 안됨
        - 출금이 완료될 떄까지 다른 트랜잭션이 접근하지 못하도록 차단함

    - ex) 항공권 예약 시스템
        - 같은 좌석을 동시에 두 사람이 예약하면 안됨, 좌석이 예약되었을 때 잠금 설정 다른 사용자는 해당 좌석을 선택할수 없도록 막는다.
        - 살짝 정보처리기사 자격증 신청할 때 ?

![스크린샷 2025-03-27 오후 4.12.55.png](..%2F..%2F..%2F..%2F..%2F..%2Fvar%2Ffolders%2Fm4%2Fn9zxyvgx4lx03pl_7nrbhpyr0000gn%2FT%2FTemporaryItems%2FNSIRD_screencaptureui_FAAZtT%2F%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-03-27%20%EC%98%A4%ED%9B%84%204.12.55.png)



---

# 결론 🚀

** 낙관적 락은 경합이 적고 읽기 연산이 많은 경우 유리하며, 충돌이 발생하면 재시도하는 방식 **

** 비관적 락은 데이터 정합성이 절대적으로 중요하고, 충돌이 빈번한 경우 필요 **

** 성능과 데이터 무결성 요구사항을 고려하여 적절한 방식 선택하는 것이 중요 **
